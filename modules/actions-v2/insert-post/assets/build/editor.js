(()=>{"use strict";const e=window.React,t=window.wp.components,n=window.wp.element,o=window.jfb.actions,{ActionFieldsMapContext:r,CurrentPropertyMapContext:a}=JetFBComponents,l=function(){const{FieldSelect:l,property:s}=(0,n.useContext)(a),{source:i,setMapField:p,getMapField:c}=(0,n.useContext)(o.CurrentActionEditContext),{name:u,index:m}=(0,n.useContext)(r);switch(s){case"meta_input":return(0,e.createElement)("div",{className:"components-base-control jet-margin-bottom-wrapper"},l,(0,e.createElement)(t.TextControl,{key:u+m+"_text",value:c({name:u}),onChange:e=>p({nameField:u,value:e}),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}));case"post_terms":return(0,e.createElement)("div",{className:"components-base-control jet-margin-bottom-wrapper"},l,(0,e.createElement)(t.SelectControl,{key:u+m+"_select",value:c({name:u}),onChange:e=>p({nameField:u,value:e}),options:i.taxonomies,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}));default:return l}},s=window.wp.hooks,i=window.jfb.components;var p=function(){const e=Array.prototype.slice.call(arguments).filter(Boolean),t={},n=[];e.forEach((e=>{(e?e.split(" "):[]).forEach((e=>{if(e.startsWith("atm_")){const[,n]=e.split("_");t[n]=e}else n.push(e)}))}));const o=[];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&o.push(t[e]);return o.push(...n),o.join(" ")};const c=window.wp.i18n,u=window.jfb.blocksToActions;class m extends wp.element.Component{constructor(e){super(e),this.addNewOption=this.addNewOption.bind(this)}getDefaultMeta(){return this.props.defaultMeta?Array.from(this.props.defaultMeta):[]}addNewOption(){const e=this.getDefaultMeta();e.push({key:"",value:""}),this.props.onChange(e)}removeOption(e){const t=this.getDefaultMeta();t.splice(e,1),this.props.onChange(t)}onChangeValue({value:e,name:t,id:n}){const o=Array.from(this.props.defaultMeta);o[n][t]=e,this.props.onChange(o)}render(){return(0,e.createElement)(e.Fragment,null,this.getDefaultMeta().map(((n,o)=>(0,e.createElement)("div",{className:"jet-user-meta__row",key:"jet-form-builder-repeater-item-"+o},(0,e.createElement)("div",{className:"repeater-item-column jet-margin-bottom-wrapper"},(0,e.createElement)(t.TextControl,{key:"meta_key",label:(0,c.__)("Meta Key","jet-form-builder"),value:n.key,onChange:e=>{this.onChangeValue({value:e,name:"key",id:o})},__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,e.createElement)(t.TextControl,{key:"meta_value",label:(0,c.__)("Meta Value","jet-form-builder"),value:n.value,onChange:e=>{this.onChangeValue({value:e,name:"value",id:o})},__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})),(0,e.createElement)("div",{className:"repeater-item-column"},(0,e.createElement)(t.Button,{icon:"dismiss",label:"Remove",onClick:()=>this.removeOption(o)}))))),(0,e.createElement)(t.FlexItem,null,(0,e.createElement)(t.Button,{className:"button-add-option",isSecondary:!0,onClick:this.addNewOption},(0,c.__)("Add New Option","jet-form-builder"))))}}const d=m,{convertListToFieldsMap:h}=JetFBActions,{ActionFieldsMap:_,WrapperRequiredControl:f,DynamicPropertySelect:E}=JetFBComponents,g=(0,s.applyFilters)("jet.fb.insert.post.modifiers",[{id:"all",isSupported:()=>!0}]),y=e=>{for(const t of g)if(t.isSupported(e))return t.id},{BaseComputedField:C}=JetFBComponents,{__:w}=wp.i18n;function b(){C.call(this),this.getSupportedActions=function(){return["insert_post"]},this.getName=function(){return"inserted_post_id"},this.getHelp=function(){return w("A computed field from the <b>Insert/Update Post</b> action.","jet-form-builder")}}b.prototype=Object.create(C.prototype);const v=b,x=e=>{const{insert_post:t={}}=e?.settings;return t.post_type};function F(){o.BaseComputedField.call(this),this.getSupportedActions=function(){return["insert_post"]},this.isSupported=function(e){return o.BaseComputedField.prototype.isSupported.call(this,e)&&x(e)},this.getName=function(){const e=this.hasInList?`_${this.action.id}`:"";return`inserted_${x(this.action)}`+e},this.getHelp=function(){return(0,c.sprintf)((0,c.__)("A computed field from the <b>Insert/Update Post (%s)</b> action.","jet-form-builder"),this.action.id)}}F.prototype=Object.create(o.BaseComputedField.prototype);const S=F,{addComputedField:j}=JetFBActions;j(v),j(S);const M={type:"insert_post",label:(0,c.__)("Insert/Update Post","jet-form-builder"),edit:function(r){const{settings:a,onChangeSettingObj:s,source:m,help:g,label:C}=r,w=h((0,u.useFields)()),[b,v]=(0,n.useState)((()=>{var e;const t=y(a);return null!==(e=m.properties[t])&&void 0!==e?e:[]}));return(0,n.useEffect)((()=>{a.requestFields?.length&&s({requestFields:null})}),[]),(0,n.useEffect)((()=>{var e;const t=y(a);v(null!==(e=m.properties[t])&&void 0!==e?e:[])}),[a.post_type]),(0,u.useSanitizeFieldsMap)(),(0,e.createElement)(t.Flex,{direction:"column"},(0,e.createElement)(i.RowControl,null,(({id:n})=>(0,e.createElement)(o.ValidatorProvider,{isSupported:e=>"post_type"===e?.property},(({hasError:o,setShowError:r})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(i.RequiredLabel,{htmlFor:n},(0,c.__)("Post type","jet-form-builder")),(0,e.createElement)(t.Flex,{className:p(i.RowControlEndStyle,o&&i.ControlWithErrorStyle),direction:"column"},o&&(0,e.createElement)(i.IconText,null,(0,c.__)("Please fill this required field","jet-form-builder")),(0,e.createElement)(t.SelectControl,{id:n,value:a.post_type,options:m.postTypes,help:g("post_type"),onChange:e=>s({post_type:e}),onBlur:()=>r(!0),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}))))))),(0,e.createElement)(i.WideLine,null),(0,e.createElement)(i.RowControl,null,(({id:n})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(i.Label,{htmlFor:n},C("post_status")),(0,e.createElement)(t.SelectControl,{id:n,value:a.post_status,options:m.postStatuses,help:g("post_status"),onChange:e=>s({post_status:e}),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})))),(0,e.createElement)(i.WideLine,null),(0,e.createElement)(_,{label:C("fields_map"),fields:w},(0,e.createElement)(f,null,(0,e.createElement)(E,{dynamic:["meta_input","post_terms"],properties:b,parseValue:e=>e.includes("jet_tax__")?"post_terms":"meta_input"},(0,e.createElement)(l,null)))),(0,e.createElement)(i.WideLine,null),(0,e.createElement)(i.RowControl,null,(0,e.createElement)(i.Label,null,C("default_meta")),(0,e.createElement)(i.RowControlEnd,null,(0,e.createElement)(d,{defaultMeta:a.default_meta,onChange:e=>s({default_meta:e})}))))},icon:(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},(0,e.createElement)("rect",{x:"0",fill:"none",width:"20",height:"20"}),(0,e.createElement)("g",null,(0,e.createElement)("path",{d:"M17 7V4h-2V2h-3v1H3v15h11V9h1V7h2zm-1-2v1h-2v2h-1V6h-2V5h2V3h1v2h2z"}))),docHref:"https://jetformbuilder.com/features/insert-update-post/",category:"content",validators:[({settings:e})=>!e?.post_type&&{type:"empty",property:"post_type"}]};(0,o.registerAction)(M)})();