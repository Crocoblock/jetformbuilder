(()=>{"use strict";function t(){this.block=null}t.prototype.isSupported=function(t){return!1},t.prototype.observe=function(){},t.prototype.setOptions=function(t){},t.prototype.isPassed=function(){throw new Error("You must provide ConditionItem::isPassed function")},t.prototype.setBlock=function(t){this.block=t};const n=t;function e(){n.call(this),this.isSupported=function(t){var n;return!(null==t||null===(n=t.field)||void 0===n||!n.length)},this.observe=function(){var t,n=this,e=this.getInput();this.block._fields=null!==(t=this.block._fields)&&void 0!==t?t:[],e&&!this.block._fields.includes(this.field)&&(this.block._fields.push(this.field),e.watch((function(){return n.block.calculate()})))},this.getInput=function(){return this.block.root.getInput(this.field)},this.isPassed=function(){var t=this.getInput();return!!t&&t.checker.check(this,t)},this.setOptions=function(t){var n=t.field,e=t.operator,i=t.value,o=t.render_state;this.field=n,this.operator=e,this.value=i,this.render_state=o}}e.prototype=Object.create(n.prototype);function i(){n.call(this),this.isSupported=function(t){var n;return!(null==t||null===(n=t.page_state)||void 0===n||!n.length)},this.setOptions=function(t){var n=t.page_state;this.pageState=n},this.isPassed=function(){var t,n,e;return"active"===this.pageState&&!(null!==(t=this.block)&&void 0!==t&&null!==(n=t.page)&&void 0!==n&&null!==(e=n.canSwitch)&&void 0!==e&&e.current)}}i.prototype=Object.create(n.prototype);const o=i;function r(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return s(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){l=!0,r=t},f:function(){try{a||null==e.return||e.return()}finally{if(l)throw r}}}}function s(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}const a=function(t,n){this.node=t,t.jfbConditional=this,this.root=n,this.invalid=[],this.undefinedFields=[],this.isObserved=!1,this.page=null,this.multistep=null,this.comment=null,this.setConditions=function(){var t=this;this.conditions=JSON.parse(this.node.dataset.jfbConditional).map((function(n){return createConditionItem(n,t)})).filter((function(t){return t}))},this.setMultiStep=function(){var t,n=createMultiStep(this);null!==(t=n.getPages())&&void 0!==t&&t.length&&(this.multistep=n)},this.setConditions(),this.setMultiStep(),this.insertComment=function(){this.willDomChange()&&(this.comment=document.createComment(""),this.node.parentElement.insertBefore(this.comment,this.node.nextSibling))},this.observe=function(){if(!this.isObserved){this.isObserved=!0,this.insertComment();var t,n=r(this.getConditions());try{for(n.s();!(t=n.n()).done;)t.value.observe()}catch(t){n.e(t)}finally{n.f()}}},this.calculate=function(){this.runFunction(this.getResult())},this.getResult=function(){this.invalid=[];var t,n={},e=0,i=r(this.getConditions());try{for(i.s();!(t=i.n()).done;){var o,s=t.value;s instanceof OrOperatorItem?e++:(n[e]=null!==(o=n[e])&&void 0!==o?o:[],n[e].push(s))}}catch(t){i.e(t)}finally{i.f()}if(!(n=Object.values(n)).length)return!0;var a,l=r(n);try{for(l.s();!(a=l.n()).done;){var u=a.value;if(this.isValidGroup(u))return!0}}catch(t){l.e(t)}finally{l.f()}return!1},this.isValidGroup=function(t){var n,e=r(t);try{for(e.s();!(n=e.n()).done;){var i=n.value;if(!i.isPassed())return this.invalid.push(i),!1}}catch(t){e.e(t)}finally{e.f()}return!0},this.runFunction=function(t){switch(this.getFunction()){case"show_dom":this.showBlockDom(t);break;case"hide_dom":this.showBlockDom(!t);break;case"show":this.showBlockCss(t);break;case"hide":this.showBlockCss(!t);break;case"disable":this.disableBlock(t)}},this.showBlockCss=function(t){this.node.style.display=t?"block":"none"},this.showBlockDom=function(t){t?this.comment.parentElement.insertBefore(this.node,this.comment):this.node.remove()},this.disableBlock=function(t){this.node.disabled=t},this.willDomChange=function(){return["show_dom","hide_dom"].includes(this.getFunction())},this.getFunction=function(){return this.node.dataset.jfbFunc},this.getConditions=function(){return this.conditions}};function l(t,n){if(t.hasOwnProperty("jfbConditional"))return t.jfbConditional;var e=new a(t,n);return e.observe(),e.calculate(),e}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}OrOperatorItem,(0,wp.hooks.addAction)("jet.fb.observe.after","jet-form-builder/conditional-block",(function(t){var n,e=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return u(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==e.return||e.return()}finally{if(a)throw r}}}}(t.rootNode.querySelectorAll("[data-jfb-conditional]"));try{for(e.s();!(n=e.n()).done;)l(n.value,this)}catch(t){e.e(t)}finally{e.f()}})),window.JetFormBuilderAbstract.ConditionPageStateItem=o,window.JetFormBuilderAbstract.ConditionalBlock=a})();