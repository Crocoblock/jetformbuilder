(()=>{"use strict";function t(){this.block=null}t.prototype.isSupported=function(t){return!1},t.prototype.observe=function(){},t.prototype.setOptions=function(t){},t.prototype.isPassed=function(){throw new Error("You must provide ConditionItem::isPassed function")},t.prototype.setBlock=function(t){this.block=t};const e=t;function n(){e.call(this),this.isSupported=function(t){var e;return!(null==t||null===(e=t.field)||void 0===e||!e.length)},this.observe=function(){var t,e=this,n=this.getInput();this.block._fields=null!==(t=this.block._fields)&&void 0!==t?t:[],n&&!this.block._fields.includes(this.field)&&(this.block._fields.push(this.field),n.watch((function(){return e.block.calculate()})))},this.getInput=function(){return this.block.root.getInput(this.field)},this.isPassed=function(){var t=this.getInput();return!!t&&t.checker.check(this,t)},this.setOptions=function(t){var e=t.field,n=t.operator,r=t.value,o=t.render_state;this.field=e,this.operator=n,this.value=r,this.render_state=o}}n.prototype=Object.create(e.prototype);const r=n;function o(){e.call(this),this.isSupported=function(t){var e;return null!==(e=t.or_operator)&&void 0!==e&&e}}o.prototype=Object.create(e.prototype);const i=o;function a(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var u=wp.hooks.doAction;function c(t,e){this.node=t,t.jfbConditional=this,this.root=e,this.invalid=[],this.undefinedFields=[],this.isObserved=!1,this.page=null,this.multistep=null,this.comment=null,this.setConditions(),u("jet.fb.conditional.init",this)}c.prototype={setConditions:function(){var t=this;this.conditions=JSON.parse(this.node.dataset.jfbConditional).map((function(e){return function(t,e){k.length||(k=O("jet.fb.conditional.types",[i,r]));var n,o=m(k);try{for(o.s();!(n=o.n()).done;){var a=new(0,n.value);if(a.isSupported(t))return a.setOptions(t),a.setBlock(e),a}}catch(t){o.e(t)}finally{o.f()}}(e,t)})).filter((function(t){return t}))},insertComment:function(){this.willDomChange()&&(this.comment=document.createComment(""),this.node.parentElement.insertBefore(this.comment,this.node.nextSibling))},observe:function(){if(!this.isObserved){this.isObserved=!0,this.insertComment();var t,e=a(this.getConditions());try{for(e.s();!(t=e.n()).done;)t.value.observe()}catch(t){e.e(t)}finally{e.f()}}},calculate:function(){this.runFunction(this.getResult())},getResult:function(){this.invalid=[];var t,e={},n=0,r=a(this.getConditions());try{for(r.s();!(t=r.n()).done;){var o,s=t.value;s instanceof i?n++:(e[n]=null!==(o=e[n])&&void 0!==o?o:[],e[n].push(s))}}catch(t){r.e(t)}finally{r.f()}if(!(e=Object.values(e)).length)return!0;var u,c=a(e);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(this.isValidGroup(l))return!0}}catch(t){c.e(t)}finally{c.f()}return!1},isValidGroup:function(t){var e,n=a(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!r.isPassed())return this.invalid.push(r),!1}}catch(t){n.e(t)}finally{n.f()}return!0},runFunction:function(t){switch(this.getFunction()){case"show_dom":this.showBlockDom(t);break;case"hide_dom":this.showBlockDom(!t);break;case"show":this.showBlockCss(t);break;case"hide":this.showBlockCss(!t);break;case"disable":this.disableBlock(t)}},showBlockCss:function(t){this.node.style.display=t?"block":"none"},showBlockDom:function(t){t?this.comment.parentElement.insertBefore(this.node,this.comment):this.node.remove()},disableBlock:function(t){this.node.disabled=t},willDomChange:function(){return["show_dom","hide_dom"].includes(this.getFunction())},getFunction:function(){return this.node.dataset.jfbFunc},getConditions:function(){return this.conditions}};const l=c;function f(){}f.prototype={isSupported:function(){return!0},check:function(t,e){var n,r,o=e.value.current;switch(t.operator){case"equal":return o===t.value;case"greater":return parseFloat(o)>parseFloat(t.value);case"less":return parseFloat(o)<parseFloat(t.value);case"between":if(2>(null===(n=t.value)||void 0===n?void 0:n.length))return!1;var i=parseFloat(t.value[0]),a=parseFloat(t.value[1]),s=parseFloat(o);return i<=s&&s<=a;case"one_of":return!(null===(r=t.value)||void 0===r||!r.length)&&0<=t.value.indexOf(o);case"contain":return 0<=o.indexOf(t.value);default:return!1}}};const h=f;var d=JetFormBuilderAbstract,p=d.CheckboxData,v=d.MultiSelectData;function b(){h.call(this),this.isSupported=function(t){return t instanceof p||t instanceof v},this.check=function(t,e){var n=e.value.current;switch(t.operator){case"one_of":return t.value.length&&n.some((function(e){return 0<=t.value.indexOf(e)}));case"contain":return n.some((function(e){return-1!==e.indexOf(t.value)}));default:return!1}}}b.prototype=Object.create(h.prototype);const y=b;function m(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var w,O=wp.hooks.applyFilters,k=[],j=[];function S(t,e){if(t.hasOwnProperty("jfbConditional"))return t.jfbConditional;var n=new l(t,e);return n.observe(),n.calculate(),n}function C(t){j.length||(j=O("jet.fb.conditional.checkers",[y,h]));var e,n=m(j);try{for(n.s();!(e=n.n()).done;){var r=new(0,e.value);if(r.isSupported(t))return r}}catch(t){n.e(t)}finally{n.f()}return null}function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){B(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var P=wp.hooks.addAction;P("jet.fb.observe.after","jet-form-builder/conditional-block",(function(t){var e,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return I(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(t.rootNode.querySelectorAll("[data-jfb-conditional]"));try{for(n.s();!(e=n.n()).done;)S(e.value,t)}catch(t){n.e(t)}finally{n.f()}})),P("jet.fb.input.onObserve","jet-form-builder/conditional-block",(function(t){t.checker=C(t)})),window.JetFormBuilderAbstract=F(F({},null!==(w=window.JetFormBuilderAbstract)&&void 0!==w?w:{}),{},{ConditionItem:e,ConditionalBlock:l,createConditionalBlock:S,createChecker:C})})();