(()=>{"use strict";const e=window.React,t=window.wp.element,n=window.jfb.actions,o=window.jfb.components,{ActionFieldsMapContext:r,CurrentPropertyMapContext:l}=JetFBComponents,s=function(){const{FieldSelect:s,property:a}=(0,t.useContext)(l),{source:i,setMapField:p,getMapField:c}=(0,t.useContext)(n.CurrentActionEditContext),{name:u,index:d}=(0,t.useContext)(r);switch(a){case"meta_input":return(0,e.createElement)("div",{className:"components-base-control jet-margin-bottom-wrapper"},s,(0,e.createElement)(o.StyledTextControl,{key:u+d+"_text",value:c({name:u}),onChange:e=>p({nameField:u,value:e})}));case"post_terms":return(0,e.createElement)("div",{className:"components-base-control jet-margin-bottom-wrapper"},s,(0,e.createElement)(o.StyledSelectControl,{key:u+d+"_select",value:c({name:u}),onChange:e=>p({nameField:u,value:e}),options:i.taxonomies}));default:return s}},a=window.wp.components,i=window.wp.hooks;var p=function(){const e=Array.prototype.slice.call(arguments).filter(Boolean),t={},n=[];e.forEach((e=>{(e?e.split(" "):[]).forEach((e=>{if(e.startsWith("atm_")){const[,n]=e.split("_");t[n]=e}else n.push(e)}))}));const o=[];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&o.push(t[e]);return o.push(...n),o.join(" ")};const c=window.wp.i18n,u=window.jfb.blocksToActions;class d extends wp.element.Component{constructor(e){super(e),this.addNewOption=this.addNewOption.bind(this)}getDefaultMeta(){return this.props.defaultMeta?Array.from(this.props.defaultMeta):[]}addNewOption(){const e=this.getDefaultMeta();e.push({key:"",value:""}),this.props.onChange(e)}removeOption(e){const t=this.getDefaultMeta();t.splice(e,1),this.props.onChange(t)}onChangeValue({value:e,name:t,id:n}){const o=Array.from(this.props.defaultMeta);o[n][t]=e,this.props.onChange(o)}render(){return(0,e.createElement)(e.Fragment,null,this.getDefaultMeta().map(((t,n)=>(0,e.createElement)("div",{className:"jet-user-meta__row",key:"jet-form-builder-repeater-item-"+n},(0,e.createElement)("div",{className:"repeater-item-column jet-margin-bottom-wrapper"},(0,e.createElement)(o.StyledTextControl,{key:"meta_key",label:(0,c.__)("Meta Key","jet-form-builder"),value:t.key,onChange:e=>{this.onChangeValue({value:e,name:"key",id:n})}}),(0,e.createElement)(o.StyledTextControl,{key:"meta_value",label:(0,c.__)("Meta Value","jet-form-builder"),value:t.value,onChange:e=>{this.onChangeValue({value:e,name:"value",id:n})}})),(0,e.createElement)("div",{className:"repeater-item-column"},(0,e.createElement)(a.Button,{icon:"dismiss",label:"Remove",onClick:()=>this.removeOption(n)}))))),(0,e.createElement)(a.FlexItem,null,(0,e.createElement)(a.Button,{className:"button-add-option",isSecondary:!0,onClick:this.addNewOption},(0,c.__)("Add New Option","jet-form-builder"))))}}const m=d,{convertListToFieldsMap:h}=JetFBActions,{ActionFieldsMap:f,WrapperRequiredControl:_,DynamicPropertySelect:y}=JetFBComponents,E=(0,i.applyFilters)("jet.fb.insert.post.modifiers",[{id:"all",isSupported:()=>!0}]),C=e=>{for(const t of E)if(t.isSupported(e))return t.id},{BaseComputedField:w}=JetFBComponents,{__:g}=wp.i18n;function b(){w.call(this),this.getSupportedActions=function(){return["insert_post"]},this.getName=function(){return"inserted_post_id"},this.getHelp=function(){return g("A computed field from the <b>Insert/Update Post</b> action.","jet-form-builder")}}b.prototype=Object.create(w.prototype);const v=b,F=e=>{const{insert_post:t={}}=e?.settings;return t.post_type};function S(){n.BaseComputedField.call(this),this.getSupportedActions=function(){return["insert_post"]},this.isSupported=function(e){return n.BaseComputedField.prototype.isSupported.call(this,e)&&F(e)},this.getName=function(){const e=this.hasInList?`_${this.action.id}`:"";return`inserted_${F(this.action)}`+e},this.getHelp=function(){return(0,c.sprintf)((0,c.__)("A computed field from the <b>Insert/Update Post (%s)</b> action.","jet-form-builder"),this.action.id)}}S.prototype=Object.create(n.BaseComputedField.prototype);const j=S,{addComputedField:x}=JetFBActions;x(v),x(j);const M={type:"insert_post",label:(0,c.__)("Insert/Update Post","jet-form-builder"),edit:function(r){const{settings:l,onChangeSettingObj:i,source:d,help:E,label:w}=r,g=h((0,u.useFields)()),[b,v]=(0,t.useState)((()=>{var e;const t=C(l);return null!==(e=d.properties[t])&&void 0!==e?e:[]}));return(0,t.useEffect)((()=>{l.requestFields?.length&&i({requestFields:null})}),[]),(0,t.useEffect)((()=>{var e;const t=C(l);v(null!==(e=d.properties[t])&&void 0!==e?e:[])}),[l.post_type]),(0,u.useSanitizeFieldsMap)(),(0,e.createElement)(a.Flex,{direction:"column"},(0,e.createElement)(o.RowControl,null,(({id:t})=>(0,e.createElement)(n.ValidatorProvider,{isSupported:e=>"post_type"===e?.property},(({hasError:n,setShowError:r})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.RequiredLabel,{htmlFor:t},(0,c.__)("Post type","jet-form-builder")),(0,e.createElement)(o.StyledFlexControl,{className:p(o.RowControlEndStyle,n&&o.ControlWithErrorStyle),direction:"column"},n&&(0,e.createElement)(o.IconText,null,(0,c.__)("Please fill this required field","jet-form-builder")),(0,e.createElement)(o.StyledSelectControl,{id:t,value:l.post_type,options:d.postTypes,help:E("post_type"),onChange:e=>i({post_type:e}),onBlur:()=>r(!0)}))))))),(0,e.createElement)(o.WideLine,null),(0,e.createElement)(o.RowControl,null,(({id:t})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(o.Label,{htmlFor:t},w("post_status")),(0,e.createElement)(o.StyledSelectControl,{id:t,value:l.post_status,options:d.postStatuses,help:E("post_status"),onChange:e=>i({post_status:e})})))),(0,e.createElement)(o.WideLine,null),(0,e.createElement)(f,{label:w("fields_map"),fields:g},(0,e.createElement)(_,null,(0,e.createElement)(y,{dynamic:["meta_input","post_terms"],properties:b,parseValue:e=>e.includes("jet_tax__")?"post_terms":"meta_input"},(0,e.createElement)(s,null)))),(0,e.createElement)(o.WideLine,null),(0,e.createElement)(o.RowControl,null,(0,e.createElement)(o.Label,null,w("default_meta")),(0,e.createElement)(o.RowControlEnd,null,(0,e.createElement)(m,{defaultMeta:l.default_meta,onChange:e=>i({default_meta:e})}))))},icon:(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},(0,e.createElement)("rect",{x:"0",fill:"none",width:"20",height:"20"}),(0,e.createElement)("g",null,(0,e.createElement)("path",{d:"M17 7V4h-2V2h-3v1H3v15h11V9h1V7h2zm-1-2v1h-2v2h-1V6h-2V5h2V3h1v2h2z"}))),docHref:"https://jetformbuilder.com/features/insert-update-post/",category:"content",validators:[({settings:e})=>!e?.post_type&&{type:"empty",property:"post_type"}]};(0,n.registerAction)(M)})();