(()=>{"use strict";function t(t){return 1==+t.dataset.repeater}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var r=JetFormBuilderAbstract,n=r.Observable,o=r.CalculatedFormula;function i(t){n.call(this,t),this.calc=1,this.initedCalc=!1}i.prototype=Object.create(n.prototype),i.prototype.calc=1,i.prototype.initedCalc=!1,i.prototype.observe=function(t){n.prototype.observe.call(this,t),this.parent.lastObserved.current=this},i.prototype.removeManually=function(){this.remove(),this.parent.remove(this),this.rootNode.remove()},i.prototype.initCalc=function(){var t,r,n,i=this;if(!this.initedCalc){this.initedCalc=!0;var a=null===(t=(r=this.parent.nodes,n=1,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(r,n)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0].dataset)||void 0===t?void 0:t.formula;if(a&&"default"!==this.parent.calcType){var l=new o(this);l.observe(a),l.setResult=function(){i.calc=l.calculate(),i.parent.value.notify()},l.relatedCallback=function(t){return t.calcValue},l.emptyValue=function(){return 0},this.calc=l.calculate(),this.parent.silenceNotify()}}};const a=i;function l(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=c(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}function c(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f=JetFormBuilderAbstract,d=f.InputData,h=f.ReactiveVar;function v(){d.call(this),this.buttonNode=!1,this.template=null,this.container=null,this.lastObserved=new h,this.lastObserved.make(),this.isSupported=function(e){return t(e)},this.addListeners=function(){},this.hasAutoScroll=function(){return!1},this.setValue=function(){var t,e,r=this,n=(t=this.nodes,e=1,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];this.value.current=[];var o,i=u(n.querySelectorAll(".jet-form-builder-repeater__row"));try{for(i.s();!(o=i.n()).done;){var l=o.value,s=new a(this);s.rootNode=l,this.value.current.push(s)}}catch(t){i.e(t)}finally{i.f()}var f,d=u(this.value.current);try{for(d.s();!(f=d.n()).done;)f.value.observe()}catch(t){d.e(t)}finally{d.f()}var h,v=u(this.value.current);try{for(v.s();!(h=v.n()).done;)h.value.initCalc()}catch(t){v.e(t)}finally{v.f()}var p,y=u(this.container.querySelectorAll(".jet-form-builder-repeater__remove"));try{var m=function(){var t=p.value,e=r.closestRow(t);if(!e)return"continue";t.addEventListener("click",(function(){return e.removeManually()}))};for(y.s();!(p=y.n()).done;)m()}catch(t){y.e(t)}finally{y.f()}if(this.isManualCount)this.buttonNode.addEventListener("click",(function(){return r.addNew()}));else{var b=this.root.getInput(this.itemsField);b?(b.watch((function(){return r.recalculateItems(b)})),this.recalculateItems(b)):console.error("JetFormBuilder error: undefined input by name [".concat(this.itemsField,"]"))}},this.setNode=function(t){var e,r,n;d.prototype.setNode.call(this,t),this.nodes=[t],this.name=t.dataset.fieldName,this.rawName=this.name,this.inputType="repeater",this.manageItems=(null===(e=t.dataset)||void 0===e?void 0:e.manageItems)||"manually",this.calcType=(null===(r=t.dataset)||void 0===r?void 0:r.calcType)||"default",this.itemsField=null===(n=t.dataset)||void 0===n?void 0:n.itemsField,this.isManualCount=!this.itemsField||"manually"===this.manageItems,this.buttonNode=t.querySelector(".jet-form-builder-repeater__new"),this.template=t.querySelector(".jet-form-builder-repeater__initial"),this.container=t.querySelector(".jet-form-builder-repeater__items")},this.onClear=function(){this.value.current=[]},this.populateInner=function(){var t;if(null===(t=this.value.current)||void 0===t||!t.length)return!1;var e,r=[],n=u(this.value.current);try{for(n.s();!(e=n.n()).done;){var o,i=u(e.value.getInputs());try{for(i.s();!(o=i.n()).done;){var a,l=o.value;null!==(a=l.reporting)&&void 0!==a&&null!==(a=a.restrictions)&&void 0!==a&&a.length&&r.push(l)}}catch(t){i.e(t)}finally{i.f()}}}catch(t){n.e(t)}finally{n.f()}return r},this.onRemove=function(){var t,e=u(this.value.current);try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}}}v.prototype=Object.create(d.prototype),v.prototype.buttonNode=null,v.prototype.template=null,v.prototype.container=null,v.prototype.itemsField=!1,v.prototype.lastObserved=null,v.prototype.addNew=function(){var t,e,r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.value.current=[].concat(l(null!==(t=null===(e=this.value)||void 0===e?void 0:e.current)&&void 0!==t?t:[]),l(new Array(n).fill(null).map((function(){return new a(r)}))))},v.prototype.findIndex=function(t){return this.value.current.findIndex((function(e){return e===t}))},v.prototype.closestRow=function(t){var e=t.closest(".jet-form-builder-repeater__row");if(!e)return!1;var r,n=u(this.value.current);try{for(n.s();!(r=n.n()).done;){var o=r.value;if(o.rootNode===e)return o}}catch(t){n.e(t)}finally{n.f()}return!1},v.prototype.remove=function(t){this.value.current=this.value.current.filter((function(e){return e!==t}))},v.prototype.recalculateItems=function(t){var e,r,n=(null!==(e=null===(r=this.value.current)||void 0===r?void 0:r.length)&&void 0!==e?e:0)-t.calcValue;0!==n&&(n<0?this.addNew(-1*n):this.value.current=this.value.current.slice(0,-1*n))};const p=v;function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m=window.JetFormBuilderAbstract.BaseSignal;function b(){m.call(this),this.isSupported=function(e,r){return t(e)},this.runSignal=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.input.value.current;null!=t&&t.length&&t.length>e.length&&this.removePrevItems(t);for(var r=0,n=Object.keys(e);r<n.length;r++){var o=n[r];e.hasOwnProperty(o)&&this.runItem(+o)}for(var i=0,a=0,l=Object.values(e);a<l.length;a++){var u=l[a];u.initCalc(),i+=u.calc}this.input.calcValue=i},this.runItem=function(t){var e=this.input.value.current[t];if(!e.isObserved){var r=document.createElement("template");r.innerHTML=this.input.template.innerHTML.trim(),r.innerHTML=r.innerHTML.replace(/__i__/g,t),r.content.firstChild.dataset.index=""+t,this.input.container.append(r.content.firstChild);var n=this.input.container.lastChild;this.input.isManualCount&&n.querySelector(".jet-form-builder-repeater__remove").addEventListener("click",(function(){return e.removeManually()})),e.observe(n)}},this.removePrevItems=function(t){var e,r=this.input.value.current,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;r.includes(o)||o.removeManually()}}catch(t){n.e(t)}finally{n.f()}}}b.prototype=Object.create(m.prototype);const g=b;var w=JetFormBuilderAbstract,S=w.AdvancedRestriction,j=w.Restriction;function A(){S.call(this),this.isSupported=function(e,r){return t(e)},this.validate=function(){return!0},this.getRawMessage=function(){return""}}S=S||j,A.prototype=Object.create(S.prototype);const I=A;function O(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||C(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t,e){if(t){if("string"==typeof t)return _(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var M=JetPlugins.hooks,T=M.addFilter,N=M.addAction;T("jet.fb.inputs","jet-form-builder/repeater-field",(function(t){return[p].concat(O(t))})),T("jet.fb.signals","jet-form-builder/repeater-field",(function(t){return[g].concat(O(t))}));var E=function(t){return t.push(I),t};T("jet.fb.restrictions.default","jet-form-builder/repeater-field",E),T("jet.fb.restrictions","jet-form-builder/repeater-field",E),N("jet.fb.multistep.page.observed.input","jet-form-builder/repeater-field",(function(t,e){if("repeater"===t.inputType){var r=t.value.current||[];t.watch((function(){return e.updateState()}));var n,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=C(t))){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}(r);try{for(o.s();!(n=o.n()).done;)n.value.getInputs().forEach(i)}catch(t){o.e(t)}finally{o.f()}t.lastObserved.watch((function(){t.lastObserved.current.getInputs().forEach(i)}))}function i(t){var r;e.handleInputEnter(t),null!==(r=t.reporting)&&void 0!==r&&null!==(r=r.restrictions)&&void 0!==r&&r.length&&t.watchValidity((function(){return e.updateState()}))}}))})();