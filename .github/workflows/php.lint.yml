name: PHP Lint & Test

on:
    # allow to manually run this workflow from the UI
    workflow_dispatch:
    push:
        paths:
            - '**.php'
    pull_request:
        paths:
            - '**.php'

jobs:
    linter:
        name: PHP CodeSniffer Linter
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout code
                uses: actions/checkout@v3

            -   name: Set up PHP
                uses: shivammathur/setup-php@v2
                with:
                    php-version: '8.0'

            -   name: Install Composer dependencies
                run: composer install

            -   name: Run PHP CodeSniffer
                run: composer phpcs
    tests:
        name: PHP Codeception tests
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout code
                uses: actions/checkout@v3

            -   name: Set up PHP
                uses: shivammathur/setup-php@v2
                with:
                    php-version: '8.0'

            -   name: Install Composer dependencies
                run: composer install

            -   name: Run PHP tests
                run: composer test