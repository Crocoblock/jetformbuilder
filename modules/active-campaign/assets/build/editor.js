(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{fetchApiData:()=>_});var r={};e.r(r),e.d(r,{getFetchError:()=>v,getFields:()=>b,getLists:()=>y,isFetchLoading:()=>w});const n=window.React,l=window.wp.i18n,a=window.wp.element,o=window.wp.data,i=window.jfb.components,c=window.wp.components,s="SET_LISTS",u="SET_FIELDS",d="START_FETCH",m="END_FETCH",p="SET_FETCH_ERROR",g=(0,o.combineReducers)({api:function(e={},t){switch(t?.type){case s:return{...e,lists:t.payload};case u:return{...e,fields:t.payload}}return e},fetch:function(e={},t){switch(t?.type){case d:return{...e,loading:!0};case m:return{...e,loading:!1};case p:return{...e,error:t.error}}return e}}),f=window.wp.apiFetch;var h=e.n(f);const E=window.wp.url,_=({apiKey:e,apiUrl:t})=>async({dispatch:r})=>{if(!e||!t)return;r({type:d}),r({type:p,error:!1});const n=(0,E.addQueryArgs)("jet-form-builder/v1/active-campaign",{apiKey:e,apiUrl:t});let l;try{l=await h()({path:n})}catch(e){return void r({type:p,error:e})}finally{r({type:m})}r({type:s,payload:l.lists}),r({type:u,payload:l.fields})};function y(e){var t;return null!==(t=e?.api?.lists)&&void 0!==t?t:[]}function b(e){var t;return null!==(t=e?.api?.fields)&&void 0!==t?t:[]}function w(e){var t;return null!==(t=e.fetch?.loading)&&void 0!==t&&t}function v(e){var t;return null!==(t=e.fetch?.error)&&void 0!==t&&t}const F="jet-forms/active-campaign",S=(0,o.createReduxStore)(F,{reducer:g,actions:t,selectors:r}),C=function({...e}){return(0,n.createElement)("div",{...e},(0,l.__)("How to obtain your ActiveCampaign API URL and Key?","jet-form-builder"),"Â ",(0,n.createElement)(c.ExternalLink,{href:"https://help.activecampaign.com/hc/en-us/articles/207317590-Getting-started-with-the-API"},(0,l.__)("More info here","jet-form-builder")))},j=window.wp.compose,L=window.wp.primitives,I=(0,n.createElement)(L.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,n.createElement)(L.Path,{d:"M17.3 10.1c0-2.5-2.1-4.4-4.8-4.4-2.2 0-4.1 1.4-4.6 3.3h-.2C5.7 9 4 10.7 4 12.8c0 2.1 1.7 3.8 3.7 3.8h9c1.8 0 3.2-1.5 3.2-3.3.1-1.6-1.1-2.9-2.6-3.2zm-.5 5.1h-9c-1.2 0-2.2-1.1-2.2-2.3s1-2.4 2.2-2.4h1.3l.3-1.1c.4-1.3 1.7-2.2 3.2-2.2 1.8 0 3.3 1.3 3.3 2.9v1.3l1.3.2c.8.1 1.4.9 1.4 1.8-.1 1-.9 1.8-1.8 1.8z"})),R=function({apiKey:e,apiUrl:t}){const{fetchApiData:r}=(0,o.useDispatch)(F),a=(0,o.useSelect)((e=>e(F).isFetchLoading()),[]);return(0,n.createElement)(i.StyledButtonControl,{onClick:()=>r({apiKey:e,apiUrl:t}),disabled:a,isBusy:a,icon:I,variant:"secondary"},(0,l.__)("Fetch","jet-form-builder"))};var T=function(){const e=Array.prototype.slice.call(arguments).filter(Boolean),t={},r=[];e.forEach((e=>{(e?e.split(" "):[]).forEach((e=>{if(e.startsWith("atm_")){const[,r]=e.split("_");t[r]=e}else r.push(e)}))}));const n=[];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(t[e]);return n.push(...r),n.join(" ")};const x=window.jfb.actions,A=function({settings:e,onChangeSettingObj:t}){const r=(0,o.useSelect)((e=>e(F).getFetchError()),[]),{hasError:a,setShowError:s}=(0,x.useActionValidatorProvider)({isSupported:e=>"api_key"===e?.property}),{hasError:u,setShowError:d}=(0,x.useActionValidatorProvider)({isSupported:e=>"api_url"===e?.property}),m=(0,j.useInstanceId)(i.RowControl,"jfb-control"),p=(0,j.useInstanceId)(i.RowControl,"jfb-control");return(0,n.createElement)(i.RowControl,{createId:!1},(0,n.createElement)(i.Label,null,(0,l.__)("API Data","jet-form-builder")),(0,n.createElement)(c.Flex,{className:T(i.RowControlEndStyle,Boolean(r)&&i.ControlWithErrorStyle),gap:3,direction:"column"},Boolean(r)&&(0,n.createElement)(i.IconText,null,(0,l.__)("Fetching data was failed","jet-form-builder")),(0,n.createElement)(i.RequiredLabel,{htmlFor:m},(0,l.__)("API URL","jet-form-builder")),u&&(0,n.createElement)(i.IconText,null,(0,l.__)("Please fill this required field","jet-form-builder")),(0,n.createElement)(i.StyledTextControl,{id:m,value:e.api_url,onChange:e=>t({api_url:e}),onBlur:()=>d(!0),className:u&&i.ControlWithErrorStyle}),(0,n.createElement)(i.RequiredLabel,{htmlFor:p},(0,l.__)("API Key","jet-form-builder")),a&&(0,n.createElement)(i.IconText,null,(0,l.__)("Please fill this required field","jet-form-builder")),(0,n.createElement)(i.StyledTextControl,{id:p,value:e.api_key,onChange:e=>t({api_key:e}),onBlur:()=>s(!0),className:a&&i.ControlWithErrorStyle}),(0,n.createElement)(c.FlexItem,null,(0,n.createElement)(R,{apiKey:e.api_key,apiUrl:e.api_url})),(0,n.createElement)(C,null)))},O=window.jfb.data,P=function(){const e=(0,o.useSelect)((e=>e(F).getFetchError()),[]),{value:t,onChange:r}=(0,O.useSiteOptionJSON)("jet_form_builder_settings__active-campaign-tab"),a=(0,j.useInstanceId)(i.RowControl,"jfb-control"),s=(0,j.useInstanceId)(i.RowControl,"jfb-control");return(0,n.createElement)(i.RowControl,{createId:!1},(0,n.createElement)(i.Label,null,(0,l.__)("API Data","jet-form-builder")),(0,n.createElement)(c.Flex,{className:T(i.RowControlEndStyle,Boolean(e)&&i.ControlWithErrorStyle),gap:3,direction:"column"},Boolean(e)&&(0,n.createElement)(i.IconText,null,(0,l.__)("Fetching data was failed","jet-form-builder")),(0,n.createElement)(i.RequiredLabel,{htmlFor:a},(0,l.__)("API URL","jet-form-builder")),(0,n.createElement)(i.StyledTextControl,{id:a,value:t.api_url,onChange:e=>r({...t,api_url:e})}),(0,n.createElement)(i.RequiredLabel,{htmlFor:s},(0,l.__)("API Key","jet-form-builder")),(0,n.createElement)(i.StyledTextControl,{id:s,value:t.api_key,onChange:e=>r({...t,api_key:e})}),(0,n.createElement)(c.FlexItem,null,(0,n.createElement)(R,{apiUrl:t.api_url,apiKey:t.api_key})),(0,n.createElement)(C,null)))},B=function({settings:e,onChangeSettingObj:t}){const r=(0,o.useSelect)((e=>e(F).getLists()),[]);return(0,n.createElement)(i.RowControl,null,(({id:a})=>(0,n.createElement)(n.Fragment,null,(0,n.createElement)(i.Label,{htmlFor:a},(0,l.__)("List Id","jet-form-builder")),(0,n.createElement)(i.StyledSelectControl,{id:a,value:e.list_id,onChange:e=>t({list_id:e}),options:[{value:"",label:"--"},...r]}))))},k=window.jfb.blocksToActions,M=function({getMapField:e,setMapField:t}){const r=(0,k.useFields)({withInner:!1,placeholder:"--"}),a=(0,o.useSelect)((e=>e(F).getFields()),[]);return(0,n.createElement)(i.RowControl,null,(0,n.createElement)(i.Label,null,(0,l.__)("Fields map","jet-form-builder")),(0,n.createElement)(c.Flex,{className:T(i.RowControlEndStyle),direction:"column",gap:4},a.map((l=>(0,n.createElement)(x.FieldsMapField,{key:l.value,tag:l.value,label:l.label,isRequired:l.required,formFields:r,value:e({name:l.value}),onChange:e=>t({nameField:l.value,value:e})})))))},N=function({settings:e,onChangeSettingObj:t}){return(0,n.createElement)(i.RowControl,{createId:!1},(0,n.createElement)(i.Label,null,(0,l.__)("Tags","jet-form-builder")),(0,n.createElement)(i.StyledFormTokenFieldControl,{value:e.tags,onChange:e=>t({tags:e})}))},{ToggleControl:U}=JetFBComponents,q={first_name:"firstName",last_name:"lastName"},K=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},(0,n.createElement)("rect",{x:"0",fill:"none",width:"20",height:"20"}),(0,n.createElement)("g",null,(0,n.createElement)("path",{d:"M16 1.1L4 5.9c-1.1.4-2 1.8-2 3v8.7c0 1.2.9 1.8 2 1.4l12-4.8c1.1-.4 2-1.8 2-3V2.5c0-1.2-.9-1.8-2-1.4zm.6 2.6l-6 9.3-6.7-4.5c-.1-.1-.4-.4-.2-.7.2-.4.7-.2.7-.2l6.3 2.3s4.8-6.3 5.1-6.7c.1-.2.4-.3.7-.1.3.2.2.5.1.6z"}))),W=[({settings:e})=>!e.use_global&&!e?.api_key&&{type:"empty",property:"api_key"},({settings:e})=>!e.use_global&&!e?.api_url&&{type:"empty",property:"api_url"},({settings:e})=>{const t=(0,o.select)(F).getFields();if(!Object.keys(t).length)return!1;const r=[];if(!t?.length)return!1;for(const n of t){if(!n.required)continue;const t=e?.fields_map?.[n.value];t||r.push({type:"empty",property:"field_"+n.value})}return r}],D={type:"active_campaign",label:(0,l.__)("Active Campaign","jet-form-builder"),edit:function(e){const{settings:t,onChangeSettingObj:r,getMapField:s,setMapField:u}=e,{isFetchLoading:d,hasLists:m,fields:p,hasError:g}=(0,o.useSelect)((e=>({isFetchLoading:e(F).isFetchLoading(),hasError:Boolean(e(F).getFetchError()),hasLists:Boolean(e(F).getLists().length),fields:e(F).getFields()})),[]);return(0,a.useEffect)((()=>{const e={};for(const[r,l]of Object.entries(null!==(n=t.fields_map)&&void 0!==n?n:{})){var n;q.hasOwnProperty(r)?e[q[r]]=l:e[r]=l}r({fields_map:e})}),[]),(0,a.useEffect)((()=>{if(!p?.length)return;const e=new Set(p.map((e=>e.value))),n={};for(const[r,l]of Object.entries(t.fields_map))e.has(r)&&(n[r]=l);r({fields_map:n})}),[d]),(0,a.useEffect)((()=>{t.tags&&!Array.isArray(t.tags)&&r({tags:t.tags.split(",").map((e=>e.trim()))})}),[]),(0,n.createElement)(c.Flex,{direction:"column"},(0,n.createElement)(U,{className:i.ClearBaseControlStyle,checked:t.use_global,onChange:e=>r({use_global:Boolean(e)})},(0,l.__)("Use","jet-form-builder")+" ",(0,n.createElement)("a",{href:JetFormEditorData.global_settings_url+"#active-campaign-tab"},(0,l.__)("Global Settings","jet-form-builder"))),(0,n.createElement)(i.WideLine,null),t.use_global?(0,n.createElement)(P,null):(0,n.createElement)(A,{settings:t,onChangeSettingObj:r}),!g&&Boolean(p.length)&&(0,n.createElement)(n.Fragment,null,m&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(i.WideLine,null),(0,n.createElement)(B,{settings:t,onChangeSettingObj:r})),(0,n.createElement)(i.WideLine,null),(0,n.createElement)(N,{settings:t,onChangeSettingObj:r}),(0,n.createElement)(i.WideLine,null),(0,n.createElement)(M,{getMapField:s,setMapField:u})))},icon:K,docHref:"https://jetformbuilder.com/features/activecampaign/",category:"communication",validators:W};(0,o.register)(S),(0,o.dispatch)("jet-forms/actions").registerAction(D)})();