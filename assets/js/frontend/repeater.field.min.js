(()=>{"use strict";function t(t){return 1==+t.dataset.repeater}function e(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var n=JetFormBuilderAbstract,o=n.Observable,i=n.CalculatedFormula;function a(t){o.call(this,t),this.calc=1}a.prototype=Object.create(o.prototype),a.prototype.calc=1,a.prototype.observe=function(t){o.prototype.observe.call(this,t),this.initCalc()},a.prototype.remove=function(){var t,r=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=e(t))){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){l=!0,a=t},f:function(){try{u||null==n.return||n.return()}finally{if(l)throw a}}}}(this.getInputs());try{for(r.s();!(t=r.n()).done;)t.value.onRemove()}catch(t){r.e(t)}finally{r.f()}this.parent.remove(this),this.rootNode.remove()},a.prototype.initCalc=function(){var t,r,n,o=this,a=null===(t=(r=this.parent.nodes,n=1,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(r,n)||e(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0].dataset)||void 0===t?void 0:t.formula;if(a){var u=new i(this);u.observe(a),u.setResult=function(){o.calc=u.calculate(),o.parent.value.notify()},u.relatedCallback=function(t){return t.calcValue},u.setResult()}};const u=a;function l(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f=JetFormBuilderAbstract.InputData;function d(){f.call(this),this.buttonNode=!1,this.template=null,this.container=null,this.isSupported=function(e){return t(e)},this.valueType=function(){return!1},this.addListeners=function(){var t=this;if(this.itemsField){var e=this.root.getInput(this.itemsField);e?e.watch((function(){var r,n,o=(null!==(r=null===(n=t.value.current)||void 0===n?void 0:n.length)&&void 0!==r?r:0)-e.calcValue;0!==o&&(o<0?t.addNew(-1*o):t.value.current=t.value.current.slice(0,-1*o))})):console.error("JetFormBuilder error: undefined input by name [".concat(this.itemsField,"]"))}else this.buttonNode.addEventListener("click",(function(){return t.addNew()}))},this.setValue=function(){var t,e,r=(t=this.nodes,e=1,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];this.value.current=[];var n,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=c(t))){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(r.querySelectorAll(".jet-form-builder-repeater__row"));try{for(o.s();!(n=o.n()).done;){var i=n.value,a=new u(this);a.observe(i),this.value.current.push(a)}}catch(t){o.e(t)}finally{o.f()}},this.setNode=function(t){f.prototype.setNode.call(this,t),this.nodes=[t],this.name=t.dataset.fieldName,this.rawName=this.name;try{var e=JSON.parse(t.dataset.settings);this.itemsField=null==e?void 0:e.itemsField}catch(t){}this.buttonNode=t.querySelector(".jet-form-builder-repeater__new"),this.template=t.querySelector(".jet-form-builder-repeater__initial"),this.container=t.querySelector(".jet-form-builder-repeater__items")},this.onClear=function(){this.value.current&&this.value.current.forEach((function(t){return t.remove()}))}}d.prototype=Object.create(f.prototype),d.prototype.buttonNode=null,d.prototype.template=null,d.prototype.container=null,d.prototype.itemsField=!1,d.prototype.addNew=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.value.current=[].concat(l(this.value.current),l(new Array(e).fill(null).map((function(){return new u(t)}))))},d.prototype.findIndex=function(t){return this.value.current.findIndex((function(e){return e===t}))},d.prototype.remove=function(t){this.value.current=this.value.current.filter((function(e){return e!==t}))};const h=d;function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var p=window.JetFormBuilderAbstract.BaseSignal;function v(){p.call(this),this.isSupported=function(e,r){return t(e)},this.runSignal=function(t){var e,r,n=this.input.value.current,o=0;t.length>n.length&&this.removePrevItems(t);for(var i=0,a=Object.entries(n);i<a.length;i++){var u=(e=a[i],r=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,r)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=u[0],c=u[1];n.hasOwnProperty(l)&&(this.runItem(l),o+=c.calc)}this.input.calcValue=o},this.runItem=function(t){var e=this.input.value.current[t];if(!e.isObserved){var r=document.createElement("template");r.innerHTML=this.input.template.innerHTML.trim();var n=this.input.value.current.length-1;r.innerHTML=r.innerHTML.replace(/__i__/g,n),r.content.firstChild.dataset.index=""+n,this.input.container.append(r.content.firstChild);var o=this.input.container.lastChild;this.input.itemsField||o.querySelector(".jet-form-builder-repeater__remove").addEventListener("click",(function(){return e.remove()})),e.observe(o)}},this.removePrevItems=function(t){var e=this.input.value.current,r=t.length>e.length;t.slice(-1*r).forEach((function(t){return t.remove()}))}}v.prototype=Object.create(p.prototype);const m=v;function b(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var w=wp.hooks.addFilter;w("jet.fb.inputs","jet-form-builder/repeater-field",(function(t){return[h].concat(b(t))})),w("jet.fb.signals","jet-form-builder/repeater-field",(function(t){return[m].concat(b(t))}))})();