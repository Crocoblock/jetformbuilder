(()=>{"use strict";function e(e){return e.parentElement.classList.contains("jet-fb-map-field")}var t=!1;function r(){return!1===t&&(t=new window.JetEngineMapsProvider),t}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){l=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){l(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=JetFormBuilderAbstract.InputData;function u(){s.call(this),this.isSupported=function(t){return e(t)},this.setNode=function(e){s.prototype.setNode.call(this,e);var t=e.parentElement;this.nodes.push(t.querySelector('[data-map-field="hash"]'),t.querySelector('[data-map-field="lat"]'),t.querySelector('[data-map-field="lng"]')),this.fieldSettings=o(o({},this.fieldSettings),JSON.parse(e.dataset.settings))},this.setValue=function(){var e=n(this.nodes,1)[0];if(e.value)switch(this.fieldSettings.format){case"location_string":var t=e.value.split(","),r=Number(t[0]),i=Number(t[1]);if(2!==t.length||Number.isNaN(r)||Number.isNaN(i))return;this.value.current={lat:r,lng:i};break;case"location_address":var a=n(this.nodes,4),o=(a[0],a[1],a[2]),l=a[3];if(null==o||!o.value||null==l||!l.value)return!1;this.value.current={lat:Number(o.value),lng:Number(null==l?void 0:l.value)};break;case"location_array":this.value.current=JSON.parse(e.value)}},this.makeReactive=function(){var e=this;s.prototype.makeReactive.call(this),new IntersectionObserver((function(t,r){t.forEach((function(t){t.isIntersecting&&(e.callable.render(),e.value.notify(),r.unobserve(t.target))}))})).observe(this.nodes[0].parentElement)}}u.prototype=Object.create(s.prototype),u.prototype.fieldSettings={height:"300",format:"location_string",field_prefix:!1};const c=u;function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,l=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){l=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){m(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=JetFormBuilderAbstract.BaseSignal,y=JetFormBuilderFunctions.toHTML;function g(){v.call(this),this.map=null,this.marker=null,this.mapFrame=null,this.position=null,this.preview=null,this.markerDefaults=h({},g.prototype.markerDefaults),this.isSupported=function(t,r){return e(t)},this.runSignal=function(){var e,t=this,r=this.input.value.current;if(r&&Object.keys(r).length){var n=p(this.input.nodes,4),i=n[0],a=(n[1],n[2]),o=n[3];switch(this.setPreview(JetMapFieldsSettings.i18n.loading),this.input.fieldSettings.format){case"location_string":e=r.lat+","+r.lng,this.updateHashFieldPromise(e).then((function(){i.value=e,t.setPreview(r)}));break;case"location_array":e=JSON.stringify(r),this.updateHashFieldPromise(e).then((function(){i.value=e,t.setPreview(r)}));break;case"location_address":wp.apiFetch({method:"get",path:JetMapFieldsSettings.api+"?lat="+r.lat+"&lng="+r.lng,headers:{nonce:JetMapFieldsSettings.nonce}}).then((function(e){e.success?e.data?t.updateHashFieldPromise(e.data).then((function(){i.value=e.data,t.setPreview(e.data)})):(i.value=null,t.setPreview(JetMapFieldsSettings.i18n.notFound)):(i.value=null,t.setPreview(e.html))})).catch((function(e){console.log(e)}))}a&&(a.value=r.lat),o&&(o.value=r.lng)}else this.removeMarker()}}g.prototype=Object.create(v.prototype),g.prototype.map=null,g.prototype.marker=null,g.prototype.preview=null,g.prototype.position=null,g.prototype.mapFrame=null,g.prototype.mapDefaults={center:{lat:41,lng:71},zoom:1},g.prototype.markerDefaults={content:'<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z" fill="#C92C2C"/></svg>',shadow:!1},g.prototype.removeMarker=function(){var e=p(this.input.nodes,4),t=e[0],n=e[1],i=e[2],a=e[3];this.marker&&r().removeMarker(this.marker),this.setPreview(null),t.value=null,i&&(i.value=null),a&&(a.value=null),n&&(n.value=null)},g.prototype.setPreview=function(e){var t;t=e&&e.lat&&e.lng?'<span title="Lat">'+e.lat+'</span>, <span title="Lng">'+e.lng+"</span>":e,this.position.innerHTML=t,this.preview.style.display=e?"flex":"none"},g.prototype.updateHashFieldPromise=function(e){var t=p(this.input.nodes,2),r=(t[0],t[1]);return r?wp.apiFetch({method:"get",path:JetMapFieldsSettings.apiHash+"?loc="+e,headers:{nonce:JetMapFieldsSettings.nonce}}).then((function(e){e.success&&(r.value=e.data)})).catch((function(e){console.log(e)})):new Promise((function(e){e()}))},g.prototype.render=function(){var e=this,t='<div class="jet-engine-map-field__preview" style="display: none; justify-content: space-between; padding: 0 0 5px; align-items: center;"><address class="jet-engine-map-field__position"></address><div class="jet-engine-map-field__reset" role="button" style="cursor: pointer; color: #c92c2c; font-weight: 500; flex-shrink: 0;">Ã— '+JetMapFieldsSettings.i18n.resetBtn+'</div></div><div class="jet-engine-map-field__frame" style="height: '+this.input.fieldSettings.height+'px; width: 100%;"></div>';this.input.root.parent&&(t+='<div class="jet-engine-map-field__description"><p style="margin-bottom: 0;"><strong>'+JetMapFieldsSettings.i18n.descTitle+":</strong> <i>"+this.input.fieldSettings.field_prefix+"_lat, "+this.input.fieldSettings.field_prefix+"_lng</i></p></div>");var n=this.input.nodes[0].parentElement;n.append(y(t)),this.preview=n.querySelector(".jet-engine-map-field__preview"),this.position=n.querySelector(".jet-engine-map-field__position"),this.mapFrame=n.querySelector(".jet-engine-map-field__frame");var i=r();null!==this.input.value.current&&(this.mapDefaults=h(h({},this.mapDefaults),{},{center:this.input.value.current,zoom:14})),this.map=i.initMap(this.mapFrame,this.mapDefaults),null!==this.input.value.current&&(this.marker=i.addMarker(h(h({},this.markerDefaults),{},{position:this.input.value.current,map:this.map}))),i.markerOnClick(this.map,this.markerDefaults,(function(t){e.marker&&i.removeMarker(e.marker),e.marker=t,e.input.value.current=i.getMarkerPosition(t,!0)})),n.querySelector(".jet-engine-map-field__reset").addEventListener("click",(function(){e.input.value.current=null}))};const b=g;function w(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var O=wp.hooks.addFilter;O("jet.fb.inputs","jet-form-builder/map-field",(function(e){return[c].concat(w(e))})),O("jet.fb.signals","jet-form-builder/map-field",(function(e){return[b].concat(w(e))}))})();