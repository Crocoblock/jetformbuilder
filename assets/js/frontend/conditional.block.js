(()=>{"use strict";function t(){}t.prototype.isSupported=function(t){return!1},t.prototype.observe=function(){},t.prototype.setOptions=function(t){},t.prototype.isPassed=function(){throw new Error("You must provide ConditionItem::isPassed function")},t.prototype.setList=function(t){this.list=t};const e=t;function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var r=JetFormBuilderAbstract.CalculatedFormula;function o(){e.call(this),this.isSupported=function(t){var e;return!(null==t||null===(e=t.field)||void 0===e||!e.length)},this.observe=function(){var t,e=this,n=this.getInput();this.list._fields=null!==(t=this.list._fields)&&void 0!==t?t:[],n&&!this.list._fields.includes(this.field)&&(this.list._fields.push(this.field),n.watch((function(){return e.list.onChangeRelated()})))},this.getInput=function(){return this.list.root.getInput(this.field)},this.isPassed=function(){var t=this.getInput();return!!t&&t.checker.check(this,t)},this.setOptions=function(t){var e=this;this.field=t.field,this.operator=t.operator,this.render_state=t.render_state,this.use_preset=t.use_preset;var o=null==t?void 0:t.value;if(Array.isArray(o)||(o=o.split(",").map((function(t){return t.trim()}))),this.use_preset)this.value=o;else{this.value={};for(var i=function(){var t,o,i=(t=s[u],o=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,s=[],l=!0,a=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){a=!0,o=t}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(a)throw o}}return s}}(t,o)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=i[0],a=i[1],c=new r(e.list.root);c.observe(a),c.setResult=function(){e.value[l]=""+c.calculate(),e.list.onChangeRelated()},c.setResult()},u=0,s=Object.entries(o);u<s.length;u++)i();this.value=Object.values(this.value)}}}o.prototype=Object.create(e.prototype),o.prototype.field=null,o.prototype.value=null,o.prototype.operator=null,o.prototype.use_preset=null;const i=o;function u(){e.call(this),this.isSupported=function(t){var e;return null!==(e=t.or_operator)&&void 0!==e&&e}}u.prototype=Object.create(e.prototype);const s=u;function l(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){s=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function c(t,e){this.root=e,this.setConditions(t)}c.prototype={root:null,conditions:[],invalid:[],groups:[],onChangeRelated:function(){this.getResult()&&this.onMatchConditions()},onMatchConditions:function(){},observe:function(){var t,e=l(this.getConditions());try{for(e.s();!(t=e.n()).done;)t.value.observe()}catch(t){e.e(t)}finally{e.f()}},setConditions:function(t){var e=this;"string"==typeof t&&(t=JSON.parse(t)),this.conditions=t.map((function(t){return function(t,e){N.length||(N=L());var n,r=D(N);try{for(r.s();!(n=r.n()).done;){var o=new(0,n.value);if(o.isSupported(t))return o.setList(e),o.setOptions(t),o}}catch(t){r.e(t)}finally{r.f()}}(t,e)})).filter((function(t){return t}));var n,r={},o=0,i=l(this.getConditions());try{for(i.s();!(n=i.n()).done;){var u,a=n.value;a instanceof s?o++:(r[o]=null!==(u=r[o])&&void 0!==u?u:[],r[o].push(a))}}catch(t){i.e(t)}finally{i.f()}this.groups=Object.values(r)},getResult:function(){if(this.invalid=[],!this.groups.length)return!0;var t,e=l(this.groups);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(this.isValidGroup(n))return!0}}catch(t){e.e(t)}finally{e.f()}return!1},isValidGroup:function(t){var e,n=l(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!r.isPassed())return this.invalid.push(r),!1}}catch(t){n.e(t)}finally{n.f()}return!0},getConditions:function(){return this.conditions}};const f=c;function h(t,e){f.call(this,t,e)}h.prototype=Object.create(f.prototype),h.prototype.block=null;const d=h;function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,s=[],l=!0,a=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){a=!0,o=t}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(a)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var v=JetPlugins.hooks.doAction,b=JetFormBuilderAbstract.ReactiveVar,m=JetFormBuilderFunctions.validateInputsAll;function g(t,e){var n;this.node=t,t.jfbConditional=this,this.root=e,this.isObserved=!1,this.list=null,this.function=null,this.settings=null,this.page=null,this.multistep=null,this.comment=null,this.inputs=[],this.isRight=new b(null),this.isRight.make(),this.setConditions(),this.setInputs(),this.setFunction(),null!==(n=window)&&void 0!==n&&null!==(n=n.JetFormBuilderSettings)&&void 0!==n&&n.devmode||(delete this.node.dataset.jfbConditional,delete this.node.dataset.jfbFunc),v("jet.fb.conditional.init",this)}g.prototype={setConditions:function(){var t=this,e=this.node.dataset.jfbConditional;this.list=new d(e,this.root),this.list.block=this,this.list.onChangeRelated=function(){t.isRight.current=t.list.getResult()}},setInputs:function(){this.inputs=Array.from(this.node.querySelectorAll("[data-jfb-sync]")).map((function(t){return t.jfbSync})).filter((function(t){return t}))},insertComment:function(){var t;null!==(t=this.settings)&&void 0!==t&&t.dom&&(this.comment=document.createComment(""),this.node.parentElement.insertBefore(this.comment,this.node.nextSibling))},observe:function(){var t=this;this.isObserved||(this.isObserved=!0,this.insertComment(),this.isRight.watch((function(){return t.runFunction()})),this.isRight.watch((function(){return t.validateInputs()})),this.list.observe())},runFunction:function(){var t=this.isRight.current;switch(this.function){case"show":this.showBlock(t);break;case"hide":this.showBlock(!t);break;case"disable":this.disableBlock(t);break;default:v("jet.fb.conditional.block.runFunction",this.function,t,this)}},validateInputs:function(){var t=this;setTimeout((function(){m(t.inputs,!0).then((function(){})).catch((function(){}))}))},showBlock:function(t){var e;this.node.classList.remove("jet-form-builder--hidden"),null!==(e=this.settings)&&void 0!==e&&e.dom?this.showBlockDom(t):this.node.style.display=t?"block":"none"},showBlockDom:function(t){t?this.comment.parentElement.insertBefore(this.node,this.comment):this.node.remove()},disableBlock:function(t){this.node.disabled=t},setFunction:function(){var t;this.function=this.node.dataset.jfbFunc;try{t=JSON.parse(this.function)}catch(t){return}var e=p(Object.entries(t),1),n=p(e[0],2),r=n[0],o=n[1];this.function=r,this.settings=o}};const j=g;var w=JetFormBuilderFunctions.isEmpty;function O(){this.operators=this.getOperators()}O.prototype={isSupported:function(t){return!0},operators:{},getOperators:function(){return{equal:function(t,e){return t===e[0]},empty:function(t){return w(t)},greater:function(t,e){return+t>+e[0]},greater_or_eq:function(t,e){return+t>=+e[0]},less:function(t,e){return+t<+e[0]},less_or_eq:function(t,e){return+t<=+e[0]},between:function(t,e){return!(null==e||!e.length||null===t)&&e[0]<=+t&&+t<=e[1]},one_of:function(t,e){return!(null==e||!e.length)&&0<=e.indexOf(t)},contain:function(t,e){return!!t&&0<=t.indexOf(e[0])}}},check:function(t,e){var n=e.value.current,r=t.value;return this.checkRaw(t.operator,n,r)},checkRaw:function(t,e,n){if(this.operators.hasOwnProperty(t))return this.operators[t](e,n);if(0!==t.indexOf("not_"))return!1;var r=t.slice(4);return!!this.operators.hasOwnProperty(r)&&!this.operators[r](e,n)}};const S=O;function A(){S.call(this),this.operators.one_of=function(t,e){return!(null==e||!e.length||null==t||!t.length)&&t.some((function(t){return-1!==e.indexOf(t)}))},this.operators.contain=function(t,e){return!(null==t||!t.length)&&t.some((function(t){return-1!==t.indexOf(e[0])}))},this.isSupported=function(t){return t.isArray()}}A.prototype=Object.create(S.prototype);const C=A;function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var I=JetFormBuilderFunctions.getTimestamp,_=JetFormBuilderConst,R=_.Min_In_Sec,F=_.Milli_In_Sec,P=(new Date).getTimezoneOffset();function B(){S.call(this),this.isSupported=function(t){var e,n,r=(e=t.nodes,n=1,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,s=[],l=!0,a=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){a=!0,o=t}finally{try{if(!l&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(a)throw o}}return s}}(e,n)||function(t,e){if(t){if("string"==typeof t)return k(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];return["date","time","datetime-local"].includes(r.type)},this.check=function(t,e){var n=I(e.value.current).time,r=t.value.map((function(e){var n=I(e),r=n.time;return"number"===n.type&&t.use_preset?r*F+P*R:r}));return this.checkRaw(t.operator,n,r)}}B.prototype=Object.create(S.prototype);const J=B;function E(){e.call(this),this.isSupported=function(t){return"render_state"===(null==t?void 0:t.operator)},this.getInput=function(){return this.list.root.getInput("_jfb_current_render_states")},this.observe=function(){var t=this;this.getInput().watch((function(){return t.list.onChangeRelated()}))},this.setOptions=function(t){var e;this.render_state=null!==(e=t.render_state)&&void 0!==e?e:[]},this.isPassed=function(){var t,e=this.getInput().value;return!(null===(t=e.current)||void 0===t||!t.length)&&this.render_state.some((function(t){return e.current.includes(t)}))}}E.prototype=Object.create(e.prototype),E.prototype.render_state=[];const x=E;function T(){S.call(this),this.isSupported=function(t){return"calculated"===t.inputType},this.check=function(t,e){var n=e.calcValue,r=t.value;return this.checkRaw(t.operator,n,r)}}T.prototype=Object.create(S.prototype);const M=T;function D(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return U(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){s=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $,q=JetPlugins.hooks.applyFilters,L=function(){return q("jet.fb.conditional.types",[x,s,i])},N=[],V=[];function G(t,e){if(t.hasOwnProperty("jfbConditional"))return t.jfbConditional;var n=new j(t,e);return n.observe(),n.list.onChangeRelated(),n}function z(t){V.length||(V=q("jet.fb.conditional.checkers",[C,J,M,S]));var e,n=D(V);try{for(n.s();!(e=n.n()).done;){var r=new(0,e.value);if(r.isSupported(t))return r}}catch(t){n.e(t)}finally{n.f()}return null}function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function H(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function K(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach((function(e){var r,o,i,u;r=t,o=e,i=n[e],u=function(t,e){if("object"!=Y(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o),(o="symbol"==Y(u)?u:u+"")in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var W=JetPlugins.hooks.addAction;W("jet.fb.observe.after","jet-form-builder/conditional-block",(function(t){var e,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){s=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}(t.rootNode.querySelectorAll("[data-jfb-conditional]"));try{for(n.s();!(e=n.n()).done;)G(e.value,t)}catch(t){n.e(t)}finally{n.f()}}),20),W("jet.fb.input.makeReactive","jet-form-builder/conditional-block",(function(t){t.checker=z(t)})),W("jet.fb.conditional.block.runFunction","jet-form-builder/conditional-block",(function(t,e,n){var r;"setCssClass"===t&&null!==(r=n.settings)&&void 0!==r&&r.className&&n.node.classList.toggle(n.settings.className,e)})),window.JetFormBuilderAbstract=K(K({},null!==($=window.JetFormBuilderAbstract)&&void 0!==$?$:{}),{},{ConditionItem:e,ConditionalBlock:j,createConditionalBlock:G,createChecker:z,ConditionsList:f})})();