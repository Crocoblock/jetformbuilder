(()=>{"use strict";var t=JetFormBuilderAbstract.ConditionItem;function e(){t.call(this),this.isSupported=function(t){var e;return!(null==t||null===(e=t.page_state)||void 0===e||!e.length)},this.setOptions=function(t){var e=t.page_state;this.pageState=e},this.isPassed=function(){var t,e,n,r;return"active"===this.pageState&&!(null!==(t=this.list)&&void 0!==t&&null!==(e=t.block)&&void 0!==e&&null!==(n=e.page)&&void 0!==n&&null!==(r=n.canSwitch)&&void 0!==r&&r.current)}}e.prototype=Object.create(t.prototype);const n=e;function r(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var i=JetFormBuilderAbstract,a=i.ReactiveVar,s=i.createConditionalBlock;function u(t,e){var n,r,o,i=this;this.node=t,this.index=+t.dataset.page,this.state=e,this.inputs=[],this.canSwitch=new a(!1),this.isShow=new a(1===this.index),this.observeInputs(),this.observeConditionalBlocks(),this.canSwitch.make(),this.isShow.make(),this.isShow.watch((function(){i.isShow.current?i.onShow():i.onHide()})),this.addButtonsListeners(),this.updateState();var s=this.state.getRoot(),u=null!==(n=null==s||null===(r=s.parent)||void 0===r||null===(o=r.root)||void 0===o?void 0:o.form)&&void 0!==n?n:s.form;u.lockState.watch((function(){i.canSwitch.current=!u.lockState.current}))}u.prototype.observeInputs=function(){var t,e=r(this.node.querySelectorAll("[data-jfb-sync]"));try{for(e.s();!(t=e.n()).done;){var n=t.value;this.isNodeBelongThis(n)&&n.hasOwnProperty("jfbSync")&&n.jfbSync.reporting.isRequired&&(this.inputs.push(n.jfbSync),n.jfbSync.setPage(this))}}catch(t){e.e(t)}finally{e.f()}},u.prototype.observeConditionalBlocks=function(){var t,e=this,o=r(this.node.querySelectorAll("[data-jfb-conditional]"));try{var i=function(){var o=t.value;if(!e.isNodeBelongThis(o))return"continue";var i=s(o,e.state.getRoot());i.isRight.watch((function(){return e.updateState()}));var a,u=r(i.list.getConditions());try{for(u.s();!(a=u.n()).done;)if(a.value instanceof n){i.page=e,e.canSwitch.watch((function(){return i.list.onChangeRelated()}));break}}catch(t){u.e(t)}finally{u.f()}};for(o.s();!(t=o.n()).done;)i()}catch(t){o.e(t)}finally{o.f()}},u.prototype.onShow=function(){this.node.classList.remove("jet-form-builder-page--hidden")},u.prototype.onHide=function(){this.node.classList.add("jet-form-builder-page--hidden")},u.prototype.updateState=function(){var t,e=this,n=[],o=r(this.getInputs());try{var i=function(){var e=t.value;n.push((function(t,n){return e.reporting.validate().then(t).catch(n)}))};for(o.s();!(t=o.n()).done;)i()}catch(t){o.e(t)}finally{o.f()}Promise.all(n.map((function(t){return new Promise(t)}))).then((function(){e.canSwitch.current=!0})).catch((function(){e.canSwitch.current=!1}))},u.prototype.addButtonsListeners=function(){var t,e=this,n=r(this.node.querySelectorAll(".jet-form-builder__next-page, .jet-form-builder__prev-page"));try{var o=function(){var n=t.value;if(!e.isNodeBelongThis(n))return"continue";var r=n.classList.contains("jet-form-builder__prev-page");n.addEventListener("click",(function(){return e.changePage(r)}))};for(n.s();!(t=n.n()).done;)o()}catch(t){n.e(t)}finally{n.f()}},u.prototype.changePage=function(t){t?this.state.index.current=this.index-1:(this.updateState(),this.canSwitch.current&&(this.state.index.current=this.index+1))},u.prototype.isNodeBelongThis=function(t){var e=t.closest(".jet-form-builder-page");return!!e&&e.isEqualNode(this.node)},u.prototype.getInputs=function(){return this.inputs};const c=u;function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const f=function(t,e){var n=this;this.node=t,this.state=e,this.state.index.watch((function(){return n.updateItems()})),this.updateItems=function(){var t,e=this.state.index.current,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(this.node.children);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=+r.dataset.page;o<e?this.makePassed(r):e===o?this.makeActive(r):this.makeNotPassed(r)}}catch(t){n.e(t)}finally{n.f()}},this.makeActive=function(t){t.classList.remove("passed-page"),t.classList.add("active-page")},this.makePassed=function(t){t.classList.add("passed-page"),t.classList.remove("active-page")},this.makeNotPassed=function(t){t.classList.remove("active-page","passed-page")}};function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=d(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function d(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var v=JetFormBuilderAbstract,y=v.ConditionalBlock,m=v.ReactiveVar;const g=function(){this.root=null,this.block=null,this.index=null,this.elements=[],this.setScope=function(t){t instanceof y?this.block=t:this.root=t},this.setPages=function(){var t,e=this;if(this.elements=(t=this.getScopeNode().children,function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||d(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).filter((function(t){return t.matches(".jet-form-builder-page")})).map((function(t){return new c(t,e)})),this.elements.length){this.index=new m(1),this.index.make(),this.index.watch((function(){return e.onChangeIndex()}));var n,r=h(this.getScopeNode().children);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.matches(".jet-form-builder-progress-pages")&&(this.progress=new f(o,this))}}catch(t){r.e(t)}finally{r.f()}}},this.onChangeIndex=function(){var t,e=h(this.getPages());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isShow.current=n.index===this.index.current}}catch(t){e.e(t)}finally{e.f()}},this.getPages=function(){return this.elements},this.getScopeNode=function(){var t,e;return null!==(t=null===(e=this.block)||void 0===e?void 0:e.node)&&void 0!==t?t:this.root.rootNode},this.getRoot=function(){var t,e;return null!==(t=null===(e=this.block)||void 0===e?void 0:e.root)&&void 0!==t?t:this.root}};function b(t){var e=new g;return e.setScope(t),e.setPages(),e}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var w=wp.hooks,A=w.addAction,j=w.addFilter;A("jet.fb.observe.after","jet-form-builder/multi-step",(function(t){var e,n=b(t);null!==(e=n.getPages())&&void 0!==e&&e.length&&(t.multistep=n)})),A("jet.fb.conditional.init","jet-form-builder/multi-step",(function(t){var e,n=b(t);null!==(e=n.getPages())&&void 0!==e&&e.length&&(t.multistep=n)})),j("jet.fb.conditional.types","jet-form-builder/multi-step",(function(t){return[n].concat(function(t){if(Array.isArray(t))return S(t)}(e=t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var e}))})();