(()=>{"use strict";function t(t){return 1==+t.dataset.repeater}function e(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var n=JetFormBuilderAbstract,o=n.Observable,i=n.CalculatedFormula;function a(t){o.call(this,t),this.calc=1}a.prototype=Object.create(o.prototype),a.prototype.calc=1,a.prototype.observe=function(t){o.prototype.observe.call(this,t),this.initCalc(),this.parent.lastObserved.current=this},a.prototype.remove=function(){var t,r=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=e(t))){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){u=!0,a=t},f:function(){try{l||null==n.return||n.return()}finally{if(u)throw a}}}}(this.getInputs());try{for(r.s();!(t=r.n()).done;)t.value.onRemove()}catch(t){r.e(t)}finally{r.f()}this.parent.remove(this),this.rootNode.remove()},a.prototype.initCalc=function(){var t,r,n,o=this,a=null===(t=(r=this.parent.nodes,n=1,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(r,n)||e(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0].dataset)||void 0===t?void 0:t.formula;if(a&&"default"!==this.parent.calcType){var l=new i(this);l.observe(a),l.setResult=function(){o.calc=l.calculate(),o.parent.value.notify()},l.relatedCallback=function(t){return t.calcValue},l.emptyValue=function(){return 0},this.calc=l.calculate(),this.parent.silenceNotify()}};const l=a;function u(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=s(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}function s(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var d=JetFormBuilderAbstract,h=d.InputData,y=d.ReactiveVar;function p(){h.call(this),this.buttonNode=!1,this.template=null,this.container=null,this.lastObserved=new y,this.lastObserved.make(),this.isSupported=function(e){return t(e)},this.addListeners=function(){},this.hasAutoScroll=function(){return!1},this.setValue=function(){var t,e,r=this,n=(t=this.nodes,e=1,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];this.value.current=[];var o,i=c(n.querySelectorAll(".jet-form-builder-repeater__row"));try{for(i.s();!(o=i.n()).done;){var a=o.value,u=new l(this);u.observe(a),this.value.current.push(u)}}catch(t){i.e(t)}finally{i.f()}var f,d=c(this.container.querySelectorAll(".jet-form-builder-repeater__remove"));try{var h=function(){var t=f.value,e=r.closestRow(t);if(!e)return"continue";t.addEventListener("click",(function(){return e.remove()}))};for(d.s();!(f=d.n()).done;)h()}catch(t){d.e(t)}finally{d.f()}if(this.isManualCount)this.buttonNode.addEventListener("click",(function(){return r.addNew()}));else{var y=this.root.getInput(this.itemsField);y?(y.watch((function(){return r.recalculateItems(y)})),this.recalculateItems(y)):console.error("JetFormBuilder error: undefined input by name [".concat(this.itemsField,"]"))}},this.setNode=function(t){h.prototype.setNode.call(this,t),this.nodes=[t],this.name=t.dataset.fieldName,this.rawName=this.name,this.inputType="repeater";try{var e=JSON.parse(t.dataset.settings);this.manageItems=(null==e?void 0:e.manageItems)||"manually",this.calcType=(null==e?void 0:e.calcType)||"default",this.itemsField=null==e?void 0:e.itemsField}catch(t){this.calcType="default",this.manageItems="manually"}this.isManualCount=!this.itemsField||"manually"===this.manageItems,this.buttonNode=t.querySelector(".jet-form-builder-repeater__new"),this.template=t.querySelector(".jet-form-builder-repeater__initial"),this.container=t.querySelector(".jet-form-builder-repeater__items")},this.onClear=function(){this.value.current=[]},this.populateInner=function(){var t;if(null===(t=this.value.current)||void 0===t||!t.length)return!1;var e,r=[],n=c(this.value.current);try{for(n.s();!(e=n.n()).done;){var o,i=c(e.value.getInputs());try{for(i.s();!(o=i.n()).done;){var a,l,u=o.value;null!==(a=u.reporting)&&void 0!==a&&null!==(l=a.restrictions)&&void 0!==l&&l.length&&r.push(u)}}catch(t){i.e(t)}finally{i.f()}}}catch(t){n.e(t)}finally{n.f()}return r}}p.prototype=Object.create(h.prototype),p.prototype.buttonNode=null,p.prototype.template=null,p.prototype.container=null,p.prototype.itemsField=!1,p.prototype.lastObserved=null,p.prototype.addNew=function(){var t,e,r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.value.current=[].concat(u(null!==(t=null===(e=this.value)||void 0===e?void 0:e.current)&&void 0!==t?t:[]),u(new Array(n).fill(null).map((function(){return new l(r)}))))},p.prototype.findIndex=function(t){return this.value.current.findIndex((function(e){return e===t}))},p.prototype.closestRow=function(t){var e=t.closest(".jet-form-builder-repeater__row");if(!e)return!1;var r,n=c(this.value.current);try{for(n.s();!(r=n.n()).done;){var o=r.value;if(o.rootNode===e)return o}}catch(t){n.e(t)}finally{n.f()}return!1},p.prototype.remove=function(t){this.value.current=this.value.current.filter((function(e){return e!==t}))},p.prototype.recalculateItems=function(t){var e,r,n=(null!==(e=null===(r=this.value.current)||void 0===r?void 0:r.length)&&void 0!==e?e:0)-t.calcValue;0!==n&&(n<0?this.addNew(-1*n):this.value.current=this.value.current.slice(0,-1*n))};const v=p;function m(t,e){if(t){if("string"==typeof t)return b(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var g=window.JetFormBuilderAbstract.BaseSignal;function w(){g.call(this),this.isSupported=function(e,r){return t(e)},this.runSignal=function(){var t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this.input.value.current,o=0;null!=r&&r.length&&r.length>n.length&&this.removePrevItems(r);for(var i=0,a=Object.entries(n);i<a.length;i++){var l=(t=a[i],e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,l=[],u=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(l.push(n.value),l.length!==e);u=!0);}catch(t){c=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,e)||m(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=l[0],c=l[1];n.hasOwnProperty(u)&&(this.runItem(+u),o+=c.calc)}this.input.calcValue=o},this.runItem=function(t){var e=this.input.value.current[t];if(!e.isObserved){var r=document.createElement("template");r.innerHTML=this.input.template.innerHTML.trim(),r.innerHTML=r.innerHTML.replace(/__i__/g,t),r.content.firstChild.dataset.index=""+t,this.input.container.append(r.content.firstChild);var n=this.input.container.lastChild;this.input.isManualCount&&n.querySelector(".jet-form-builder-repeater__remove").addEventListener("click",(function(){return e.remove()})),e.observe(n)}},this.removePrevItems=function(t){var e,r=this.input.value.current,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=m(t))){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;r.includes(o)||o.remove()}}catch(t){n.e(t)}finally{n.f()}}}w.prototype=Object.create(g.prototype);const S=w;var A=JetFormBuilderAbstract,j=A.AdvancedRestriction,I=A.Restriction;function O(){j.call(this),this.isSupported=function(e,r){return t(e)},this.validate=function(){return!0},this.getRawMessage=function(){return""}}j=j||I,O.prototype=Object.create(j.prototype);const T=O;function _(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||E(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){if(t){if("string"==typeof t)return C(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var N=JetPlugins.hooks,F=N.addFilter,M=N.addAction;F("jet.fb.inputs","jet-form-builder/repeater-field",(function(t){return[v].concat(_(t))})),F("jet.fb.signals","jet-form-builder/repeater-field",(function(t){return[S].concat(_(t))}));var x=function(t){return t.push(T),t};F("jet.fb.restrictions.default","jet-form-builder/repeater-field",x),F("jet.fb.restrictions","jet-form-builder/repeater-field",x),M("jet.fb.multistep.page.observed.input","jet-form-builder/repeater-field",(function(t,e){if("repeater"===t.inputType){var r=t.value.current||[];t.watch((function(){return e.updateState()}));var n,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=E(t))){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}(r);try{for(o.s();!(n=o.n()).done;)n.value.getInputs().forEach(i)}catch(t){o.e(t)}finally{o.f()}t.lastObserved.watch((function(){t.lastObserved.current.getInputs().forEach(i)}))}function i(t){var r,n;e.handleInputEnter(t),null!==(r=t.reporting)&&void 0!==r&&null!==(n=r.restrictions)&&void 0!==n&&n.length&&t.watchValidity((function(){return e.updateState()}))}}))})();